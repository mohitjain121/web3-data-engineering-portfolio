/* Description: Calculate average and median age of wallets */

WITH
  age AS (
    SELECT
      wallet,
      MAX(age) AS age_days
    FROM
      (
        SELECT
          "to" AS wallet,
          (
            DATE_TRUNC('day', now()) - DATE_TRUNC('day', MIN(evt_block_time))
          ) as age
        FROM
          erc20."ERC20_evt_Transfer"
        WHERE
          "to" IN (
            '\xDf5fa32B726a5118281e74aD3B7C707423e28F8B',
            '\xeC5c16f3EAF86a801a3E89201DD39bDDD1786cBF',
            '\x9Ec01d2A66Ac9A6173050383e1EFD93f5b883294',
            '\x10DbC99C90234E4447f0366e8368d688f622475A',
            '\x64Af258F8522Bb9dD2c2B648B9CBBCDbe986B0BF',
            '\xb6bbE5a785F6cfEd3F65F2BA91AD20586B00f7E6',
            '\xcF10A8E7c907144cc87721aC1fD7Ac75a8aebeC7',
            '\x32ffC2374fA900FDe59D7B7388Bb4a9A9Dbe6123',
            '\x5B36002E5Ee1103A44246f67b067FD5509b97A9E',
            '\xe3cf9bE65Fe3E9786E5E85f29f72499190FB3eE5',
            '\xB1E8897458e06bC542Af612ac440b9edFF4363B8',
            '\xB69e74324bc030F1B5409236EFA461496D439116',
            '\x61cE616a39F5735F844a3BC5D67Fe2ab8E64e702',
            '\x917b4B0E86fC7766695095dD1A5292B3BE8b2D14',
            '\xd61daEBC28274d1feaAf51F11179cd264e4105fB',
            '\x4254966AeB7A6a3a5A60b05219Eb356B70F12Ccc',
            '\x018439894b681cC2aAdDB613A425a1cfA6e59c29',
            '\xFF16d64179A02D6a56a1183A28f1D6293646E2dd',
            '\x2FFEd3158bB66a974E46E17E94b17e93202B804b',
            '\x64eCc4f8fF76E58d7C2245f34d32B039ebF42bDf',
            '\x324Fbd9536bf3d77d36137310fd4abe5130DfEA9',
            '\xD7625B5eb8c96128A901EF90FE0ED01C287d253B',
            '\x862225a65786E198db423c686341913CaC8a5B3a',
            '\x5fa18F60c6e4a08493ABd3A4da7B02E20B0Cb2F9',
            '\x3e3672B23eB22946A31263d2D178bF0fB1f4BBFD',
            '\x976FdC5DfA145E3cbc690E9fef4a408642732952',
            '\x3d409b7CaC949135657A9eE5f59FfC27E0Bf5d6E',
            '\x45740E393a093Cb341Eb0Cb8772605A6b7034A87',
            '\x3a031CD5d4e1AcF9e6897Ff87Da169Ea08DDf22C',
            '\xBA1b35Eb69052aEF4CE95abC0c38e0Ff67410aEf',
            '\x77a13bE3e954c4370aeFE93BB5634283DB5e3D87',
            '\xAea790Ce88C2994390a97BfBE45b6743569a9020',
            '\x7Ebe10f8e493e848396839eC22d92001B82eA592',
            '\x47d312c7604b1751f691011AeD4cE32231Bff4d1',
            '\xd861415F6703ab50Ce101C7E6f6A80ada1FC2B1c',
            '\x01985690D95d15aB17F26BBA1A466703EA4367B3',
            '\xC6563c29f364F7E661FE112A02caA987F87B956f',
            '\x5208C58fB7e4561453EEA7622430928b6F7cc2FC',
            '\x273061aA9B9dDdDcE5b7C2D1EB7237611d558d4F',
            '\x706D961Ab69d54a0FCbaa13E77842279A5724139',
            '\x46d3101e96dfe3F84A7EEA176AA3699107900a9c',
            '\x0161d1Cc10116bb2a073A0c293d5E4F1a97A00b6',
            '\x1Cf693eceEbEee99aD60e82973E2d4829C801335',
            '\xC00fC2775cce5b61ffd6Ec1eEc0De0119f25DC87',
            '\x6936b10D58D9aC6292ABf1167C0D9eec64615D86',
            '\x2E63EE889BB210392CED9C03D3c0BdAf97E1CC08',
            '\xE14a13b8eB93B6569a748EA57A1A97025fc82BE9',
            '\x7796D7E2F04b2854cB32F52C6014bEe89fD93C18',
            '\x7e1FF06fc9adACa7383560F3d674C6b686AEf67e',
            '\xa1909f656e11086902c23Ce4BC2EE1B4950aDAeE',
            '\x7A60e93Df6Ed28C63D5E9283BD91b3C1dC3e613B',
            '\x15F60D31A768f7f69AD39315cD49A76C6d7cDF0a',
            '\x9bE394Eb181fccb33e624FDfFE9EB0Dba830f4c5',
            '\x6960d1fA290F0a60896D23Fc3b533a9b0de03644',
            '\x9e89b2e39841a7c3b35a161E78b1d4ba198602CC',
            '\x2498F34bF4276E8b535717701Ab6b2D3c50310D5',
            '\x4beBBc16403627fD16facD2D9Be0Ba21aFad7fd8',
            '\x23b6d8e09CB33B1550DE19aC25cC3F41ae4603Bb',
            '\x11eBeE2bF244325B5559f0F583722d35659DDcE8',
            '\xF68D2BfCecd7895BBa05a7451Dd09A1749026454'
          )
        GROUP BY
          1
        UNION
        SELECT
          "to" AS wallet,
          (
            DATE_TRUNC('day', now()) - DATE_TRUNC('day', MIN(evt_block_time))
          ) as age
        FROM
          erc721."ERC721_evt_Transfer"
        WHERE
          "to" IN (
            '\xDf5fa32B726a5118281e74aD3B7C707423e28F8B',
            '\xeC5c16f3EAF86a801a3E89201DD39bDDD1786cBF',
            '\x9Ec01d2A66Ac9A6173050383e1EFD93f5b883294',
            '\x10DbC99C90234E4447f0366e8368d688f622475A',
            '\x64Af258F8522Bb9dD2c2B648B9CBBCDbe986B0BF',
            '\xb6bbE5a785F6cfEd3F65F2BA91AD20586B00f7E6',
            '\xcF10A8E7c907144cc87721aC1fD7Ac75a8aebeC7',
            '\x32ffC2374fA900FDe59D7B7388Bb4a9A9Dbe6123',
            '\x5B36002E5Ee1103A44246f67b067FD5509b97A9E',
            '\xe3cf9bE65Fe3E9786E5E85f29f72499190FB3eE5',
            '\xB1E8897458e06bC542Af612ac440b9edFF4363B8',
            '\xB69e74324bc030F1B5409236EFA461496D439116',
            '\x61cE616a39F5735F844a3BC5D67Fe2ab8E64e702',
            '\x917b4B0E86fC7766695095dD1A5292B3BE8b2D14',
            '\xd61daEBC28274d1feaAf51F11179cd264e4105fB',
            '\x4254966AeB7A6a3a5A60b05219Eb356B70F12Ccc',
            '\x018439894b681cC2aAdDB613A425a1cfA6e59c29',
            '\xFF16d64179A02D6a56a1183A28f1D6293646E2dd',
            '\x2FFEd3158bB66a974E46E17E94b17e93202B804b',
            '\x64eCc4f8fF76E58d7C2245f34d32B039ebF42bDf',
            '\x324Fbd9536bf3d77d36137310fd4abe5130DfEA9',
            '\xD7625B5eb8c96128A901EF90FE0ED01C287d253B',
            '\x862225a65786E198db423c686341913CaC8a5B3a',
            '\x5fa18F60c6e4a08493ABd3A4da7B02E20B0Cb2F9',
            '\x3e3672B23eB22946A31263d2D178bF0fB1f4BBFD',
            '\x976FdC5DfA145E3cbc690E9fef4a408642732952',
            '\x3d409b7CaC949135657A9eE5f59FfC27E0Bf5d6E',
            '\x45740E393a093Cb341Eb0Cb8772605A6b7034A87',
            '\x3a031CD5d4e1AcF9e6897Ff87Da169Ea08DDf22C',
            '\xBA1b35Eb69052aEF4CE95abC0c38e0Ff67410aEf',
            '\x77a13bE3e954c4370aeFE93BB5634283DB5e3D87',
            '\xAea790Ce88C2994390a97BfBE45b6743569a9020',
            '\x7Ebe10f8e493e848396839eC22d92001B82eA592',
            '\x47d312c7604b1751f691011AeD4cE32231Bff4d1',
            '\xd861415F6703ab50Ce101C7E6f6A80ada1FC2B1c',
            '\x01985690D95d15aB17F26BBA1A466703EA4367B3',
            '\xC6563c29f364F7E661FE112A02caA987F87B956f',
            '\x5208C58fB7e4561453EEA7622430928b6F7cc2FC',
            '\x273061aA9B9dDdDcE5b7C2D1EB7237611d558d4F',
            '\x706D961Ab69d54a0FCbaa13E77842279A5724139',
            '\x46d3101e96dfe3F84A7EEA176AA3699107900a9c',
            '\x0161d1Cc10116bb2a073A0c293d5E4F1a97A00b6',
            '\x1Cf693eceEbEee99aD60e82973E2d4829C801335',
            '\xC00fC2775cce5b61ffd6Ec1eEc0De0119f25DC87',
            '\x6936b10D58D9aC6292ABf1167C0D9eec64615D86',
            '\x2E63EE889BB210392CED9C03D3c0BdAf97E1CC08',
            '\xE14a13b8eB93B6569a748EA57A1A97025fc82BE9',
            '\x7796D7E2F04b2854cB32F52C6014bEe89fD93C18',
            '\x7e1FF06fc9adACa7383560F3d674C6b686AEf67e',
            '\xa1909f656e11086902c23Ce4BC2EE1B4950aDAeE',
            '\x7A60e93Df6Ed28C63D5E9283BD91b3C1dC3e613B',
            '\x15F60D31A768f7f69AD39315cD49A76C6d7cDF0a',
            '\x9bE394Eb181fccb33e624FDfFE9EB0Dba830f4c5',
            '\x6960d1fA290F0a60896D23Fc3b533a9b0de03644',
            '\x9e89b2e39841a7c3b35a161E78b1d4ba198602CC',
            '\x2498F34bF4276E8b535717701Ab6b2D3c50310D5',
            '\x4beBBc16403627fD16facD2D9Be0Ba21aFad7fd8',
            '\x23b6d8e09CB33B1550DE19aC25cC3F41ae4603Bb',
            '\x11eBeE2bF244325B5559f0F583722d35659DDcE8',
            '\xF68D2BfCecd7895BBa05a7451Dd09A1749026454'
          )
        GROUP BY
          1
      ) age
    GROUP BY
      1
    ORDER BY
      2 DESC
  )
SELECT
  DATE_TRUNC('DAY', AVG(age_days)) AS avg_age,
  DATE_TRUNC(
    'DAY',
    PERCENTILE_CONT(0.5) WITHIN GROUP(
      ORDER BY
        age_days
    )
  ) AS med_age
FROM
  age